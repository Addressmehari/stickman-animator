<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Stickman Animator Pro</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mobile.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-container">
      <header class="top-bar">
        <div class="logo">
          <span class="icon">‚ö°</span>
          <h1>StickMotion</h1>
        </div>
        <div class="controls">
          <button id="btn-play" class="btn btn-primary" title="Play Animation">
            <span class="play-icon">‚ñ∂</span> Play
          </button>
          <button
            id="btn-stop"
            class="btn btn-secondary hidden"
            title="Stop Animation"
          >
            <span class="stop-icon">‚ñ†</span> Stop
          </button>

          <div class="separator-vertical"></div>

          <select
            id="select-playback-mode"
            class="select-input"
            title="Playback Mode"
          >
            <option value="loop">üîÅ Loop</option>
            <option value="pingpong">üèì Ping Pong</option>
            <option value="once">‚û°Ô∏è One Shot</option>
          </select>
          <div class="separator-vertical"></div>
          <button id="btn-import" class="btn btn-outline" title="Import JSON">
            Import JSON
          </button>
          <input
            type="file"
            id="file-import"
            accept=".json"
            style="display: none"
          />
          <button id="btn-export" class="btn btn-outline" title="Export JSON">
            Export JSON
          </button>
        </div>
      </header>

      <main class="workspace">
        <div class="viewport">
          <div class="canvas-wrapper">
            <canvas id="anim-canvas" width="800" height="600"></canvas>
            
            <!-- Context Bar (Point Properties) -->
            <div id="point-properties" class="context-bar hidden">
               <div class="context-header">Selected Joint</div>
               <div class="context-content">
                  <div class="control-group compact">
                    <label for="point-easing">Transition</label>
                    <div class="select-wrapper">
                      <select id="point-easing">
                        <option value="linear">Linear</option>
                        <option value="easeInOutCubic">Smooth</option>
                        <option value="easeInQuad">Ease In</option>
                        <option value="easeOutQuad">Ease Out</option>
                        <option value="easeOutBack">Overshoot</option>
                        <option value="easeOutElastic">Elastic</option>
                        <option value="easeOutBounce">Bounce</option>
                      </select>
                    </div>
                  </div>
                  <div class="separator-vertical"></div>
                  <div class="control-row">
                     <label class="toggle-control small" title="Passthrough (Auto-Tween)">
                        <input type="checkbox" id="point-passthrough">
                        <span class="toggle-label">Passthrough</span>
                     </label>
                  </div>
               </div>
            </div>

            <div class="canvas-overlay-minimal">
              <div class="frame-tag">
                Frame <span id="current-frame-num">1</span>
              </div>
            </div>
          </div>
        </div>

        <aside class="sidebar-right">
          <div class="sidebar-header">
            <h2>Properties</h2>
          </div>

          <div class="sidebar-content">
            <!-- Section: View Options -->
            <div class="panel-section">
              <div class="panel-title">View Options</div>
              <div class="control-row">
                <label class="toggle-control">
                  <input type="checkbox" id="chk-onion-skin" checked />
                  <span class="toggle-label">Onion Skin</span>
                </label>
              </div>
            </div>

            <!-- Section: Tool Settings -->
            <div class="panel-section">
              <div class="panel-title">Tool Settings</div>
              <div class="control-row">
                <label
                  class="toggle-control"
                  title="Inverse Kinematics: Dragging hands/feet automagically bends elbows/knees"
                >
                  <input type="checkbox" id="chk-ik-mode" />
                  <span class="toggle-label">Enable IK Mode ü¶æ</span>
                </label>
              </div>
            </div>

            <!-- Section: Tool Settings -->
            <div class="panel-section">
              <div class="panel-title">Tool Settings</div>
              <div class="control-row">
                <label
                  class="toggle-control"
                  title="Inverse Kinematics: Dragging hands/feet automagically bends elbows/knees"
                >
                  <input type="checkbox" id="chk-ik-mode" />
                  <span class="toggle-label">Enable IK Mode ü¶æ</span>
                </label>
              </div>
            </div>

            <!-- Section: Rotoscoping -->
            <div class="panel-section">
              <div class="panel-title">Rotoscopy (Background)</div>

              <div class="bg-actions">
                <button id="btn-upload-bg" class="btn-sidebar-action">
                  Load Media
                </button>
                <input
                  type="file"
                  id="file-bg"
                  accept="image/*,video/*"
                  class="hidden"
                />
                <button
                  id="btn-clear-bg"
                  class="btn-sidebar-icon hidden"
                  title="Clear"
                >
                  ‚úï
                </button>
              </div>

              <div id="bg-settings" class="bg-settings hidden">
                <div class="control-group">
                  <label
                    >Opacity
                    <span id="bg-opacity-val" class="val-tag">50%</span></label
                  >
                  <input
                    type="range"
                    id="rng-bg-opacity"
                    min="0"
                    max="1"
                    step="0.1"
                    value="0.5"
                    class="styled-range"
                  />
                </div>

                <div class="control-group">
                  <label
                    >Scale
                    <span id="bg-scale-val" class="val-tag">1.0x</span></label
                  >
                  <input
                    type="range"
                    id="rng-bg-scale"
                    min="0.1"
                    max="5.0"
                    step="0.1"
                    value="1.0"
                    class="styled-range"
                  />
                </div>

                <div class="control-row">
                  <label
                    class="toggle-control"
                    title="Edit Background Position/Scale"
                  >
                    <input type="checkbox" id="chk-edit-bg" />
                    <span class="toggle-label">Edit Mode</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </main>

      <footer class="timeline-panel">
        <div class="timeline-header">
          <h3>Timeline</h3>
          <button
            id="btn-delete-frame"
            class="btn btn-sm btn-secondary"
            style="margin-right: 10px; display: none"
          >
            üóë Delete Frame
          </button>
          <button id="btn-add-frame" class="btn btn-sm btn-accent">
            + New Frame
          </button>
        </div>
        <div class="timeline-track-container">
          <div id="timeline-track" class="timeline-track">
            <!-- Frames will be injected here via JS -->
            <!-- Example Structure:
                    <div class="frame-card active">1</div>
                    <div class="transition-bar">
                        <input type="range" min="0.1" max="5.0" step="0.1" value="0.5">
                        <span class="duration-label">0.5s</span>
                    </div>
                    <div class="frame-card">2</div> 
                    -->
          </div>
        </div>
      </footer>
    </div>

    <!-- Modal for Export -->
    <div id="export-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Export Animation</h2>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="control-group" style="margin-bottom: 15px;">
             <label for="export-name" style="margin-bottom: 5px;">File Name</label>
             <input type="text" id="export-name" placeholder="animation" class="select-input" style="width: 100%; color: #fff; cursor: text;">
          </div>
          <p style="margin-bottom: 5px;">JSON Preview:</p>
          <textarea id="export-output" readonly></textarea>
          <button id="btn-download" class="btn btn-primary full-width">
            Download JSON
          </button>
        </div>
      </div>
    </div>

    <div id="sidebar-overlay" class="sidebar-overlay hidden"></div>
    <button id="btn-toggle-sidebar" class="fab-btn" title="Open Settings">‚öôÔ∏è</button>

    <script src="app.js"></script>
  </body>
</html>
